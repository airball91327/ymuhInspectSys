@model IEnumerable<InspectSystem.Models.InspectClassVModel>

@{
    ViewBag.Title = "巡檢單編輯";
}
<link rel="stylesheet" type="text/css" href="~/Content/MyStyles/MyDocEditStyle.css" />
<link rel="stylesheet" type="text/css" href="~/Font-awesome-5.14.0/css/all.min.css">
<script src="~/Font-awesome-5.14.0/js/all.min.js"></script>
<script src="~/Scripts/ScrollToTop.js"></script>

<div class="container">

    <h3>@ViewBag.Header</h3>

    <div id="tab" class="btn-group" data-toggle="buttons-radio">
        @foreach (var item in Model)
        {
            <button class="btn btn-large btn-primary tablinks" data-toggle="tab" href="#inspectEdit" onclick="showClassContents(event, '@item.DocId', '@item.ShiftId', '@item.ClassId')" id="@item.ClassId">
                @if (item.IsSaved == true)
                {
                    <span class="far fa-check-circle"></span>
                }
                @item.ClassName
                @if (item.CountErrors != 0)
                {
                    <span class="badge badge-pill badge-danger">@item.CountErrors</span>
                }
            </button>
        }
        <button class="btn btn-large btn-info" data-toggle="tab" href="#inspectDoc">案件資訊</button>
        <button class="btn btn-large btn-info" id="btnNextFlow" value="@ViewBag.AllSaved">送出交班</button>
    </div>

    <div class="tab-content card">
        <div id="inspectEdit" class="tab-pane fade show active">

        </div>
        <div id="inspectDoc" class="tab-pane fade ">
            @Html.Action("Details", "InspectDocIdTable", new { id = Model.First().DocId })
        </div>
    </div>
</div>

<button onclick="topFunction()" id="goToTopBtn" title="Go to top">回頁首</button>


@section Scripts{
    <script src="~/Scripts/jquery.unobtrusive-ajax.js"></script>
    <script src="~/Scripts/jquery.toast.js"></script>

    <script type="text/javascript">
        $(document).ready(function () {
            //Default class content is first item from tablinks.
            var tabs = document.getElementsByClassName("tablinks");
            tabs.item(0).click();
            //
            var value = $("#btnNextFlow").val();
            if (value == "true") {
                $("#btnNextFlow").removeAttr("disabled");
            }
            else {
                $("#btnNextFlow").attr("disabled", true);
            }
            //
            $("#btnNextFlow").click(function () {
                var docId = '@Model.First().DocId';
                var shiftId = '@Model.First().ShiftId';
                var url = '@Url.Action("Edit", "InspectDocDetailTemp")';
                url = url + "?docId=" + docId + "&shiftId=" + shiftId;
                location.href = url;
            });
        });
        function showmsg(data) {
            if (data.success == null) {
                // search success.
                $.Toast.hideToast();
            }
            else {
                if (data.success === false) {
                    alert(data.error);
                    $.Toast.hideToast();
                }
            }
        }
        function showClassContents(evt, docId, shiftId, classId) {
            var url = '@Url.Action("GetClassContentEdit", "InspectDocDetailTemp")';
            $.ajax({
                type: "GET",
                url: url,
                data: { docId: docId, shiftId: shiftId, classId: classId },
                beforeSend: function () {
                    $.Toast.showToast({ 'title': '讀取中，請稍待...', 'icon': 'loading', 'duration': 0 });
                },
                complete: function () {
                    $.Toast.hideToast();
                },
                success: function (result) {
                    $("#inspectEdit").html(result);
                },
                error: function (msg) {
                    alert("讀取錯誤!");
                }
            });
        }
    </script>
}